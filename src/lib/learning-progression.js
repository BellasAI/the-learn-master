/**
 * Learning Progression System
 * 
 * Guides users through their learning journey from casual YouTube videos
 * to structured online courses to formal education credentials.
 * 
 * Learning Journey Stages:
 * 1. Foundation (YouTube + Free Resources)
 * 2. Structured Learning (Online Courses + Certifications)
 * 3. Formal Education (Degrees + Professional Credentials)
 */

export const LEARNING_STAGES = {
  FOUNDATION: {
    id: 'foundation',
    name: 'Foundation Learning',
    description: 'Start with free, flexible YouTube content and tutorials',
    icon: 'play',
    color: 'blue',
    duration: '1-3 months',
    commitment: '5-10 hours/week',
    cost: 'Free',
    outcomes: [
      'Understand core concepts',
      'Build basic skills',
      'Explore interests',
      'Learn at your own pace'
    ],
    nextSteps: [
      'Complete 80% of curated videos',
      'Practice with hands-on projects',
      'Join community discussions',
      'Assess readiness for structured learning'
    ]
  },
  STRUCTURED: {
    id: 'structured',
    name: 'Structured Learning',
    description: 'Advance with guided courses, projects, and certificates',
    icon: 'book',
    color: 'purple',
    duration: '3-12 months',
    commitment: '10-20 hours/week',
    cost: '$50-$500/month',
    outcomes: [
      'Master intermediate concepts',
      'Complete guided projects',
      'Earn recognized certificates',
      'Build portfolio'
    ],
    nextSteps: [
      'Complete professional certification',
      'Build substantial portfolio',
      'Gain practical experience',
      'Consider formal degree if needed'
    ]
  },
  FORMAL: {
    id: 'formal',
    name: 'Formal Education',
    description: 'Pursue degrees, advanced credentials, and career credentials',
    icon: 'graduation-cap',
    color: 'green',
    duration: '1-4 years',
    commitment: '20-40 hours/week',
    cost: '$5,000-$50,000+',
    outcomes: [
      'Earn recognized degree',
      'Deep theoretical knowledge',
      'Professional network',
      'Career advancement'
    ],
    nextSteps: [
      'Complete degree program',
      'Pursue advanced specializations',
      'Contribute to field',
      'Mentor others'
    ]
  }
}

/**
 * Generate a complete learning progression path for a topic
 */
export function generateLearningProgression(topic, userLevel = 'beginner', userGoals = []) {
  const progression = {
    topic,
    currentStage: determineCurrentStage(userLevel, userGoals),
    stages: []
  }

  // Stage 1: Foundation (YouTube + Free Resources)
  progression.stages.push({
    stage: LEARNING_STAGES.FOUNDATION,
    resources: {
      youtube: {
        title: 'Curated YouTube Learning Path',
        description: `Start your ${topic} journey with carefully selected YouTube videos`,
        provider: 'The Learn Master',
        items: [
          'Beginner-friendly introductions',
          'Core concept explanations',
          'Practical demonstrations',
          'Real-world examples'
        ],
        estimatedTime: '20-40 hours',
        cost: 'Free',
        link: 'internal' // Generated by our research engine
      },
      freeResources: {
        title: 'Free Learning Resources',
        description: 'Complement videos with articles, documentation, and tutorials',
        items: generateFreeResources(topic),
        estimatedTime: '10-20 hours',
        cost: 'Free'
      },
      practice: {
        title: 'Hands-On Practice',
        description: 'Apply what you learn with practical exercises',
        items: generatePracticeResources(topic),
        estimatedTime: '20-30 hours',
        cost: 'Free'
      }
    },
    readinessCheck: {
      title: 'Ready for Structured Learning?',
      criteria: [
        'Completed 80%+ of YouTube learning path',
        'Can explain core concepts in your own words',
        'Completed at least 3 practice projects',
        'Feel confident with fundamentals',
        'Ready to commit 10+ hours/week'
      ],
      action: 'Take our readiness assessment'
    },
    transitionSupport: {
      message: 'Great progress! You\'re ready to move beyond YouTube videos into structured learning with guided projects and certificates.',
      benefits: [
        'Structured curriculum with clear progression',
        'Hands-on projects with feedback',
        'Industry-recognized certificates',
        'Community and peer learning'
      ]
    }
  })

  // Stage 2: Structured Learning (Online Courses + Certifications)
  progression.stages.push({
    stage: LEARNING_STAGES.STRUCTURED,
    resources: {
      onlineCourses: {
        title: 'Professional Online Courses',
        description: 'Structured programs with projects and certificates',
        items: generateOnlineCourses(topic),
        estimatedTime: '100-300 hours',
        cost: '$50-$500'
      },
      certifications: {
        title: 'Professional Certifications',
        description: 'Industry-recognized credentials',
        items: generateCertifications(topic),
        estimatedTime: '50-200 hours',
        cost: '$100-$2,000'
      },
      bootcamps: {
        title: 'Intensive Bootcamps',
        description: 'Fast-track your learning with immersive programs',
        items: generateBootcamps(topic),
        estimatedTime: '12-24 weeks full-time',
        cost: '$5,000-$20,000'
      },
      projects: {
        title: 'Portfolio Projects',
        description: 'Build real-world projects to demonstrate skills',
        items: generateProjectIdeas(topic),
        estimatedTime: '50-100 hours',
        cost: 'Free'
      }
    },
    readinessCheck: {
      title: 'Ready for Formal Education?',
      criteria: [
        'Earned professional certification',
        'Built substantial portfolio (5+ projects)',
        'Gained practical work experience',
        'Career goals require formal degree',
        'Ready to commit 20+ hours/week for 1-4 years'
      ],
      action: 'Explore degree programs'
    },
    transitionSupport: {
      message: 'You\'ve built strong skills and credentials. A formal degree can provide deep theoretical knowledge, research opportunities, and career advancement.',
      benefits: [
        'Comprehensive theoretical foundation',
        'Research and innovation opportunities',
        'Professional network and mentorship',
        'Career advancement and higher earning potential',
        'Academic credentials (BS, MS, PhD)'
      ],
      considerations: [
        'Significant time commitment (1-4 years)',
        'Higher cost ($10K-$100K+)',
        'Less flexible schedule',
        'May not be necessary for all career paths'
      ]
    }
  })

  // Stage 3: Formal Education (Degrees + Advanced Credentials)
  progression.stages.push({
    stage: LEARNING_STAGES.FORMAL,
    resources: {
      undergraduateDegrees: {
        title: 'Undergraduate Degrees (Bachelor\'s)',
        description: 'Comprehensive 4-year programs',
        items: generateUndergraduateDegrees(topic),
        estimatedTime: '4 years full-time',
        cost: '$20,000-$200,000'
      },
      graduateDegrees: {
        title: 'Graduate Degrees (Master\'s)',
        description: 'Advanced specialization programs',
        items: generateGraduateDegrees(topic),
        estimatedTime: '1-2 years full-time',
        cost: '$15,000-$100,000'
      },
      doctoralPrograms: {
        title: 'Doctoral Programs (PhD)',
        description: 'Research-focused advanced degrees',
        items: generateDoctoralPrograms(topic),
        estimatedTime: '4-7 years',
        cost: 'Often funded'
      },
      professionalDegrees: {
        title: 'Professional Degrees & Credentials',
        description: 'Industry-specific advanced credentials',
        items: generateProfessionalDegrees(topic),
        estimatedTime: 'Varies',
        cost: 'Varies'
      }
    },
    careerOutcomes: {
      title: 'Career Outcomes',
      description: 'What you can achieve with formal education',
      outcomes: generateCareerOutcomes(topic),
      salaryRange: generateSalaryRange(topic),
      jobTitles: generateJobTitles(topic)
    }
  })

  return progression
}

/**
 * Determine user's current stage based on level and goals
 */
function determineCurrentStage(userLevel, userGoals) {
  if (userGoals.includes('degree') || userGoals.includes('phd') || userGoals.includes('masters')) {
    return 'formal'
  }
  if (userGoals.includes('certificate') || userGoals.includes('career-change') || userLevel === 'intermediate') {
    return 'structured'
  }
  return 'foundation'
}

/**
 * Generate free learning resources for a topic
 */
function generateFreeResources(topic) {
  const topicLower = topic.toLowerCase()
  
  const resources = [
    {
      name: 'Wikipedia',
      type: 'Encyclopedia',
      url: `https://en.wikipedia.org/wiki/${encodeURIComponent(topic)}?ref=learnmaster&utm_source=learnmaster&utm_campaign=free_resources`,
      description: 'Comprehensive overview and background'
    },
    {
      name: 'Khan Academy',
      type: 'Interactive Tutorials',
      url: `https://www.khanacademy.org/search?search_again=1&page_search_query=${encodeURIComponent(topic)}&ref=learnmaster`,
      description: 'Free interactive lessons and practice'
    },
    {
      name: 'freeCodeCamp',
      type: 'Tutorials',
      url: `https://www.freecodecamp.org/news/search/?query=${encodeURIComponent(topic)}&ref=learnmaster`,
      description: 'In-depth articles and tutorials'
    }
  ]

  // Add topic-specific resources
  if (topicLower.includes('programming') || topicLower.includes('coding')) {
    resources.push({
      name: 'MDN Web Docs',
      type: 'Documentation',
      url: 'https://developer.mozilla.org/?ref=learnmaster',
      description: 'Comprehensive web development documentation'
    })
  }

  return resources
}

/**
 * Generate practice resources and project ideas
 */
function generatePracticeResources(topic) {
  return [
    {
      name: 'GitHub',
      type: 'Code Repository',
      url: `https://github.com/search?q=${encodeURIComponent(topic)}&ref=learnmaster`,
      description: 'Explore open-source projects and code examples'
    },
    {
      name: 'Stack Overflow',
      type: 'Q&A Community',
      url: `https://stackoverflow.com/search?q=${encodeURIComponent(topic)}&ref=learnmaster`,
      description: 'Get answers to specific questions'
    },
    {
      name: 'Reddit Communities',
      type: 'Discussion Forums',
      url: `https://www.reddit.com/search/?q=${encodeURIComponent(topic)}&ref=learnmaster`,
      description: 'Join discussions and share progress'
    }
  ]
}

/**
 * Generate online course recommendations
 */
function generateOnlineCourses(topic) {
  return [
    {
      name: 'Coursera',
      program: `${topic} Specialization`,
      provider: 'Top Universities',
      duration: '3-6 months',
      cost: '$49/month',
      certificate: 'Yes',
      url: `https://www.coursera.org/search?query=${encodeURIComponent(topic)}&ref=learnmaster&utm_source=learnmaster&utm_campaign=structured_learning`,
      description: 'University-level courses with certificates'
    },
    {
      name: 'Udemy',
      program: `Complete ${topic} Course`,
      provider: 'Industry Experts',
      duration: '20-50 hours',
      cost: '$10-$200 (one-time)',
      certificate: 'Yes',
      url: `https://www.udemy.com/courses/search/?q=${encodeURIComponent(topic)}&ref=learnmaster&utm_source=learnmaster`,
      description: 'Practical, project-based courses'
    },
    {
      name: 'Pluralsight',
      program: `${topic} Path`,
      provider: 'Technology Experts',
      duration: '30-100 hours',
      cost: '$29/month',
      certificate: 'Yes',
      url: `https://www.pluralsight.com/search?q=${encodeURIComponent(topic)}&ref=learnmaster`,
      description: 'Technology skill development'
    }
  ]
}

/**
 * Generate certification recommendations
 */
function generateCertifications(topic) {
  const topicLower = topic.toLowerCase()
  const certs = []

  if (topicLower.includes('programming') || topicLower.includes('software')) {
    certs.push({
      name: 'Professional Certificate',
      provider: 'Google/IBM/Meta',
      duration: '3-6 months',
      cost: '$39/month',
      url: 'https://www.coursera.org/professional-certificates?ref=learnmaster',
      recognition: 'Industry-recognized'
    })
  }

  // Generic certifications
  certs.push({
    name: 'LinkedIn Learning Certificate',
    provider: 'LinkedIn',
    duration: '1-3 months',
    cost: '$29.99/month',
    url: `https://www.linkedin.com/learning/search?keywords=${encodeURIComponent(topic)}&ref=learnmaster`,
    recognition: 'Professional credential'
  })

  return certs
}

/**
 * Generate bootcamp recommendations
 */
function generateBootcamps(topic) {
  const topicLower = topic.toLowerCase()
  const bootcamps = []

  if (topicLower.includes('programming') || topicLower.includes('web') || topicLower.includes('software')) {
    bootcamps.push(
      {
        name: 'General Assembly',
        program: 'Software Engineering Immersive',
        duration: '12 weeks',
        cost: '$15,000',
        format: 'Full-time or Part-time',
        url: 'https://generalassemb.ly/?ref=learnmaster',
        outcomes: 'Career support and job placement'
      },
      {
        name: 'App Academy',
        program: 'Software Engineering',
        duration: '16-24 weeks',
        cost: 'Deferred tuition',
        format: 'Full-time',
        url: 'https://www.appacademy.io/?ref=learnmaster',
        outcomes: 'Pay after you get a job'
      }
    )
  }

  if (topicLower.includes('data') || topicLower.includes('ai') || topicLower.includes('machine learning')) {
    bootcamps.push({
      name: 'DataCamp',
      program: 'Data Science Track',
      duration: '3-6 months',
      cost: '$25/month',
      format: 'Self-paced online',
      url: 'https://www.datacamp.com/?ref=learnmaster',
      outcomes: 'Career tracks and projects'
    })
  }

  return bootcamps
}

/**
 * Generate project ideas for portfolio building
 */
function generateProjectIdeas(topic) {
  const topicLower = topic.toLowerCase()
  
  if (topicLower.includes('web') || topicLower.includes('programming')) {
    return [
      'Build a personal portfolio website',
      'Create a full-stack web application',
      'Contribute to open-source projects',
      'Develop a mobile app',
      'Build an API service'
    ]
  }

  return [
    `Create a comprehensive ${topic} project`,
    'Document your learning journey',
    'Build a portfolio showcasing your work',
    'Contribute to community projects',
    'Present at local meetups or conferences'
  ]
}

/**
 * Generate undergraduate degree programs
 */
function generateUndergraduateDegrees(topic) {
  return [
    {
      name: 'Arizona State University Online',
      degree: 'Bachelor of Science',
      duration: '4 years',
      cost: '$15,000/year',
      format: 'Online',
      url: 'https://asuonline.asu.edu/?ref=learnmaster',
      accreditation: 'Fully accredited'
    },
    {
      name: 'University of Florida Online',
      degree: 'Bachelor\'s Degree',
      duration: '4 years',
      cost: '$12,000/year',
      format: 'Online',
      url: 'https://ufonline.ufl.edu/?ref=learnmaster',
      accreditation: 'Fully accredited'
    }
  ]
}

/**
 * Generate graduate degree programs
 */
function generateGraduateDegrees(topic) {
  const topicLower = topic.toLowerCase()
  
  if (topicLower.includes('computer') || topicLower.includes('software') || topicLower.includes('ai')) {
    return [
      {
        name: 'Georgia Tech',
        degree: 'Master of Science in Computer Science',
        duration: '2-3 years',
        cost: '$7,000 total',
        format: 'Online',
        url: 'https://omscs.gatech.edu/?ref=learnmaster',
        ranking: 'Top 10 CS program'
      },
      {
        name: 'University of Illinois',
        degree: 'Master of Computer Science',
        duration: '2-3 years',
        cost: '$22,000 total',
        format: 'Online',
        url: 'https://cs.illinois.edu/academics/graduate/professional-mcs?ref=learnmaster',
        ranking: 'Top 5 CS program'
      }
    ]
  }

  return [
    {
      name: 'Top University Online',
      degree: `Master's in ${topic}`,
      duration: '1-2 years',
      cost: '$20,000-$40,000',
      format: 'Online or Hybrid',
      url: `https://www.coursera.org/degrees?query=${encodeURIComponent(topic)}&ref=learnmaster`,
      accreditation: 'Fully accredited'
    }
  ]
}

/**
 * Generate doctoral programs
 */
function generateDoctoralPrograms(topic) {
  return [
    {
      name: 'Research Universities',
      degree: 'PhD',
      duration: '4-7 years',
      cost: 'Often funded with stipend',
      format: 'On-campus (typically)',
      url: `https://www.phds.org/search?q=${encodeURIComponent(topic)}&ref=learnmaster`,
      focus: 'Research and academia'
    }
  ]
}

/**
 * Generate professional degree options
 */
function generateProfessionalDegrees(topic) {
  return [
    {
      name: 'Executive Education',
      degree: 'Professional Certificate',
      duration: '3-12 months',
      cost: '$5,000-$20,000',
      format: 'Hybrid',
      url: 'https://www.edx.org/executive-education?ref=learnmaster',
      target: 'Working professionals'
    }
  ]
}

/**
 * Generate career outcomes
 */
function generateCareerOutcomes(topic) {
  return [
    'Senior-level positions',
    'Leadership and management roles',
    'Research and innovation',
    'Teaching and mentorship',
    'Entrepreneurship opportunities'
  ]
}

/**
 * Generate salary range
 */
function generateSalaryRange(topic) {
  const topicLower = topic.toLowerCase()
  
  if (topicLower.includes('software') || topicLower.includes('ai') || topicLower.includes('data')) {
    return {
      entry: '$70,000-$100,000',
      mid: '$100,000-$150,000',
      senior: '$150,000-$250,000+',
      note: 'Varies by location and company'
    }
  }

  return {
    entry: '$50,000-$70,000',
    mid: '$70,000-$100,000',
    senior: '$100,000-$150,000+',
    note: 'Varies by industry and location'
  }
}

/**
 * Generate job titles
 */
function generateJobTitles(topic) {
  const topicLower = topic.toLowerCase()
  
  if (topicLower.includes('software') || topicLower.includes('programming')) {
    return [
      'Software Engineer',
      'Senior Software Developer',
      'Tech Lead',
      'Engineering Manager',
      'Chief Technology Officer'
    ]
  }

  return [
    `${topic} Specialist`,
    `Senior ${topic} Professional`,
    `${topic} Manager`,
    `${topic} Director`,
    `Chief ${topic} Officer`
  ]
}

/**
 * Check if user is ready to progress to next stage
 */
export function assessReadiness(userProgress, currentStage) {
  const criteria = {
    foundation: {
      videosCompleted: userProgress.videosCompleted >= userProgress.totalVideos * 0.8,
      projectsCompleted: userProgress.projectsCompleted >= 3,
      timeSpent: userProgress.totalHours >= 40,
      selfAssessment: userProgress.confidenceLevel >= 7
    },
    structured: {
      certificationsEarned: userProgress.certificationsEarned >= 1,
      portfolioProjects: userProgress.portfolioProjects >= 5,
      practicalExperience: userProgress.workExperience >= 6, // months
      careerGoals: userProgress.needsDegree === true
    }
  }

  const currentCriteria = criteria[currentStage]
  if (!currentCriteria) return { ready: false, score: 0 }

  const scores = Object.values(currentCriteria).map(c => c ? 1 : 0)
  const score = scores.reduce((a, b) => a + b, 0) / scores.length

  return {
    ready: score >= 0.75,
    score: Math.round(score * 100),
    criteria: currentCriteria,
    nextSteps: generateNextSteps(currentStage, currentCriteria)
  }
}

/**
 * Generate personalized next steps
 */
function generateNextSteps(currentStage, criteria) {
  const incomplete = Object.entries(criteria)
    .filter(([_, met]) => !met)
    .map(([criterion]) => criterion)

  const suggestions = {
    videosCompleted: 'Complete remaining YouTube videos in your learning path',
    projectsCompleted: 'Build more hands-on projects to practice',
    timeSpent: 'Dedicate more time to learning and practice',
    selfAssessment: 'Review fundamentals and test your understanding',
    certificationsEarned: 'Earn a professional certification',
    portfolioProjects: 'Build more substantial portfolio projects',
    practicalExperience: 'Gain practical work experience or internships',
    careerGoals: 'Assess if a formal degree aligns with your career goals'
  }

  return incomplete.map(criterion => suggestions[criterion])
}

